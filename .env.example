# Core runtime
DATABASE_URL=postgresql://user:password@localhost:5432/recsys
DB_INIT_ON_STARTUP=true
DB_POOL_MIN_SIZE=1
DB_POOL_MAX_SIZE=10

# API runtime
UVICORN_WORKERS=2
RECO_ASYNC_IMPRESSION_LOGGING=true
RECO_BACKGROUND_SHUTDOWN_TIMEOUT_SEC=5

# Kafka dual-write
# API no longer writes directly to Kafka; relay publishes from transactional outbox
WATCH_FEATURE_UPDATE_MODE=async_consumer
# If API runs on host use localhost:29092, in docker-compose use kafka:9092
KAFKA_BOOTSTRAP_SERVERS=localhost:29092
KAFKA_TOPIC_IMPRESSIONS=recsys.impressions.v1
KAFKA_TOPIC_WATCHES=recsys.watches.v1
KAFKA_CLIENT_ID=recsys-api
KAFKA_REQUEST_TIMEOUT_MS=15000

# Transactional outbox + relay
OUTBOX_MAX_ATTEMPTS=25
OUTBOX_RELAY_POLL_INTERVAL_MS=500
OUTBOX_RELAY_BATCH_SIZE=200
OUTBOX_RELAY_LEASE_SEC=30
OUTBOX_RELAY_BASE_RETRY_SEC=1
OUTBOX_RELAY_MAX_RETRY_SEC=60

# Kafka feature consumer
FEATURE_CONSUMER_GROUP_ID=recsys-feature-consumer-v1
FEATURE_CONSUMER_CLIENT_ID=recsys-feature-consumer
FEATURE_CONSUMER_POLL_TIMEOUT_MS=1000
FEATURE_CONSUMER_MAX_POLL_RECORDS=500
STREAM_FEATURE_HISTORY_SIZE=20

# Metrics
PROMETHEUS_METRICS_ENABLED=false
METRICS_HOST=0.0.0.0
METRICS_PORT=9108

# Per-service metrics ports in docker-compose
OUTBOX_RELAY_METRICS_PORT=9109
FEATURE_CONSUMER_METRICS_PORT=9110

# Online serving cache
ONLINE_CACHE_ENABLED=true
ONLINE_CACHE_BACKEND=memory
ONLINE_CACHE_STRICT_BACKEND=false
ONLINE_CACHE_REDIS_URL=redis://localhost:6379/0
ONLINE_CACHE_REDIS_TIMEOUT_SEC=1
ONLINE_CACHE_MEMORY_MAX_KEYS=100000
ONLINE_CACHE_HISTORY_TTL_SEC=20
ONLINE_CACHE_RELATED_TTL_SEC=30
ONLINE_CACHE_POPULARITY_TTL_SEC=5

# Postgres (for docker-compose)
POSTGRES_DB=recsys
POSTGRES_USER=user
POSTGRES_PASSWORD=password
